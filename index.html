import React, { useState } from 'react';
import { Users, Play, Plus, X, Eye, EyeOff } from 'lucide-react';

export default function MafiaGame() {
  const [screen, setScreen] = useState('home');
  const [players, setPlayers] = useState([]);
  const [newPlayerName, setNewPlayerName] = useState('');
  const [mafiaCount, setMafiaCount] = useState(1);
  const [roles, setRoles] = useState([]);
  const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
  const [showRole, setShowRole] = useState(false);
  const [nightPhase, setNightPhase] = useState('');
  const [killedPlayer, setKilledPlayer] = useState('');
  const [savedPlayer, setSavedPlayer] = useState('');
  const [investigatedPlayer, setInvestigatedPlayer] = useState('');
  const [investigationResult, setInvestigationResult] = useState('');

  const addPlayer = () => {
    if (newPlayerName.trim() && players.length < 14) {
      setPlayers([...players, newPlayerName.trim()]);
      setNewPlayerName('');
    }
  };

  const removePlayer = (index) => {
    setPlayers(players.filter((_, i) => i !== index));
  };

  const startGame = () => {
    if (players.length < 4) {
      alert('ูุฌุจ ุฃู ูููู ููุงู ุนูู ุงูุฃูู 4 ูุงุนุจูู!');
      return;
    }

    const gameRoles = ['ุทุจูุจ', 'ูุญูู'];
    
    for (let i = 0; i < mafiaCount; i++) {
      gameRoles.push('ูุงููุง');
    }
    
    while (gameRoles.length < players.length) {
      gameRoles.push('ููุงุทู');
    }

    const shuffled = [...gameRoles].sort(() => Math.random() - 0.5);
    const playerRoles = players.map((name, index) => ({
      name,
      role: shuffled[index]
    }));

    setRoles(playerRoles);
    setCurrentPlayerIndex(0);
    setShowRole(false);
    setScreen('reveal');
  };

  const nextPlayer = () => {
    if (currentPlayerIndex < roles.length - 1) {
      setCurrentPlayerIndex(currentPlayerIndex + 1);
      setShowRole(false);
    } else {
      setScreen('instructions');
    }
  };

  const startNightPhase = () => {
    setNightPhase('mafia');
    setKilledPlayer('');
    setSavedPlayer('');
    setInvestigatedPlayer('');
    setInvestigationResult('');
  };

  const handleMafiaKill = (playerName) => {
    setKilledPlayer(playerName);
    setNightPhase('doctor');
  };

  const handleDoctorSave = (playerName) => {
    setSavedPlayer(playerName);
    setNightPhase('detective');
  };

  const handleDetectiveInvestigate = (playerName) => {
    setInvestigatedPlayer(playerName);
    const player = roles.find(p => p.name === playerName);
    const isMafia = player.role === 'ูุงููุง';
    setInvestigationResult(isMafia ? 'ูุนูุ ูู ูุงููุง!' : 'ูุงุ ููุณ ูุงููุง');
    setNightPhase('results');
  };

  const getRoleInstructions = (role) => {
    switch (role) {
      case 'ูุงููุง':
        return 'ุฃูุช ุนุถู ูู ุงููุงููุง! ูููุชู ูุชู ุงูููุงุทููู ูููุงู ูุงูุชุฎูู ููุงุฑูุง';
      case 'ุทุจูุจ':
        return 'ุฃูุช ุงูุทุจูุจ! ููููู ุญูุงูุฉ ุดุฎุต ูุงุญุฏ ูู ูููุฉ ูู ุงููุชู';
      case 'ูุญูู':
        return 'ุฃูุช ุงููุญูู! ููููู ุงูุชุญูู ูู ูุงุนุจ ูุงุญุฏ ูู ูููุฉ ููุนุฑูุฉ ุฅุฐุง ูุงู ูุงููุง ุฃู ูุง';
      case 'ููุงุทู':
        return 'ุฃูุช ููุงุทู! ุญุงูู ุงูุชุดุงู ุงููุงููุง ูุงูุชุตููุช ูุทุฑุฏูู ููุงุฑูุง';
      default:
        return '';
    }
  };

  const getRoleColor = (role) => {
    switch (role) {
      case 'ูุงููุง':
        return 'bg-red-600';
      case 'ุทุจูุจ':
        return 'bg-green-600';
      case 'ูุญูู':
        return 'bg-blue-600';
      case 'ููุงุทู':
        return 'bg-gray-600';
      default:
        return 'bg-gray-600';
    }
  };

  if (screen === 'home') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <div className="text-center mb-8">
            <h1 className="text-5xl font-bold text-white mb-2">๐ญ ูุงููุง</h1>
            <p className="text-gray-400">ูุนุจุฉ ุงูุบููุถ ูุงูุฎุฏุงุน</p>
          </div>

          <button
            onClick={() => setScreen('register')}
            className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-xl mb-4 flex items-center justify-center gap-2 transition-all transform hover:scale-105"
          >
            <Users size={24} />
            ุชุณุฌูู ุงูุฃุณูุงุก
          </button>

          {players.length >= 4 && (
            <button
              onClick={startGame}
              className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 transition-all transform hover:scale-105"
            >
              <Play size={24} />
              ุจุฏุก ุงููุนุจุฉ
            </button>
          )}

          {players.length > 0 && (
            <div className="mt-6 p-4 bg-gray-700 rounded-xl">
              <p className="text-white font-bold mb-2">ุงููุงุนุจูู ุงููุณุฌููู: {players.length}</p>
              <div className="flex flex-wrap gap-2">
                {players.map((player, index) => (
                  <span key={index} className="bg-purple-600 text-white px-3 py-1 rounded-full text-sm">
                    {player}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }

  if (screen === 'register') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-3xl font-bold text-white mb-6 text-center">ุชุณุฌูู ุงููุงุนุจูู</h2>

          <div className="mb-6">
            <label className="block text-white mb-2 font-bold">ุนุฏุฏ ุงููุงููุง:</label>
            <div className="flex gap-4">
              <button
                onClick={() => setMafiaCount(1)}
                className={`flex-1 py-3 rounded-xl font-bold transition-all ${
                  mafiaCount === 1 ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-400'
                }`}
              >
                ูุงููุง ูุงุญุฏ
              </button>
              <button
                onClick={() => setMafiaCount(2)}
                className={`flex-1 py-3 rounded-xl font-bold transition-all ${
                  mafiaCount === 2 ? 'bg-red-600 text-white' : 'bg-gray-700 text-gray-400'
                }`}
              >
                ูุงููุง ุงุซููู
              </button>
            </div>
          </div>

          <div className="mb-6">
            <div className="flex gap-2">
              <input
                type="text"
                value={newPlayerName}
                onChange={(e) => setNewPlayerName(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && addPlayer()}
                placeholder="ุงุณู ุงููุงุนุจ"
                className="flex-1 px-4 py-3 bg-gray-700 text-white rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500"
                maxLength={20}
              />
              <button
                onClick={addPlayer}
                disabled={players.length >= 14}
                className="bg-purple-600 hover:bg-purple-700 text-white p-3 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <Plus size={24} />
              </button>
            </div>
            <p className="text-gray-400 text-sm mt-2">
              ุงููุงุนุจูู: {players.length} / 14 (ุงูุญุฏ ุงูุฃุฏูู: 4)
            </p>
          </div>

          <div className="mb-6 max-h-60 overflow-y-auto">
            {players.map((player, index) => (
              <div
                key={index}
                className="flex items-center justify-between bg-gray-700 p-3 rounded-xl mb-2"
              >
                <span className="text-white font-bold">{player}</span>
                <button
                  onClick={() => removePlayer(index)}
                  className="text-red-500 hover:text-red-400"
                >
                  <X size={20} />
                </button>
              </div>
            ))}
          </div>

          <div className="flex gap-4">
            <button
              onClick={() => setScreen('home')}
              className="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-xl transition-all"
            >
              ุฑุฌูุน
            </button>
            <button
              onClick={startGame}
              disabled={players.length < 4}
              className="flex-1 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all"
            >
              ุจุฏุก ุงููุนุจุฉ
            </button>
          </div>
        </div>
      </div>
    );
  }

  if (screen === 'reveal') {
    const currentPlayer = roles[currentPlayerIndex];
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <div className="text-center mb-8">
            <h2 className="text-3xl font-bold text-white mb-4">
              ุฏูุฑ ุงููุงุนุจ: {currentPlayer.name}
            </h2>
            <p className="text-gray-400 mb-6">
              ุงููุงุนุจ {currentPlayerIndex + 1} ูู {roles.length}
            </p>
          </div>

          {!showRole ? (
            <button
              onClick={() => setShowRole(true)}
              className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-6 px-6 rounded-xl flex items-center justify-center gap-2 transition-all transform hover:scale-105 mb-4"
            >
              <Eye size={24} />
              ุงุถุบุท ูุฑุคูุฉ ุฏูุฑู
            </button>
          ) : (
            <div className="mb-6">
              <div className={`${getRoleColor(currentPlayer.role)} text-white p-8 rounded-xl text-center mb-4`}>
                <p className="text-4xl font-bold mb-2">{currentPlayer.role}</p>
              </div>
              <div className="bg-gray-700 p-4 rounded-xl">
                <p className="text-white text-center">{getRoleInstructions(currentPlayer.role)}</p>
              </div>
            </div>
          )}

          {showRole && (
            <button
              onClick={nextPlayer}
              className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105"
            >
              {currentPlayerIndex < roles.length - 1 ? 'ุงููุงุนุจ ุงูุชุงูู' : 'ุงุจุฏุฃ ุงููููุฉ ุงูุฃููู'}
            </button>
          )}
        </div>
      </div>
    );
  }

  if (screen === 'instructions') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
        <div className="max-w-2xl w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-4xl font-bold text-white mb-8 text-center">๐ ุชุฑุชูุจ ุงููููุฉ</h2>
          
          <div className="space-y-6 mb-8">
            <div className="bg-red-900 p-6 rounded-xl">
              <h3 className="text-2xl font-bold text-white mb-2">1๏ธโฃ ุฏูุฑ ุงููุงููุง</h3>
              <p className="text-gray-300">ุงููุงููุง ูุฎุชุงุฑ ุดุฎุตูุง ูููุชู</p>
            </div>

            <div className="bg-green-900 p-6 rounded-xl">
              <h3 className="text-2xl font-bold text-white mb-2">2๏ธโฃ ุฏูุฑ ุงูุทุจูุจ</h3>
              <p className="text-gray-300">ุงูุทุจูุจ ูุฎุชุงุฑ ุดุฎุตูุง ููุญูุงูุฉ</p>
            </div>

            <div className="bg-blue-900 p-6 rounded-xl">
              <h3 className="text-2xl font-bold text-white mb-2">3๏ธโฃ ุฏูุฑ ุงููุญูู</h3>
              <p className="text-gray-300">ุงููุญูู ูุณุฃู ุนู ุดุฎุต: ูู ูู ูุงููุงุ (ูุนู/ูุง ููุท)</p>
            </div>
          </div>

          <button
            onClick={startNightPhase}
            className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105"
          >
            ุงุจุฏุฃ ุงููููุฉ ุงูุฃููู
          </button>
        </div>
      </div>
    );
  }

  if (nightPhase === 'mafia') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-red-900 via-gray-900 to-black flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-3xl font-bold text-red-500 mb-6 text-center">๐ช ุฏูุฑ ุงููุงููุง</h2>
          <p className="text-white text-center mb-6">ุงุฎุชุฑ ุงูุดุฎุต ุงูุฐู ุชุฑูุฏ ูุชูู</p>
          
          <div className="space-y-2 max-h-96 overflow-y-auto">
            {roles.map((player, index) => (
              <button
                key={index}
                onClick={() => handleMafiaKill(player.name)}
                className="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-xl transition-all"
              >
                {player.name}
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  if (nightPhase === 'doctor') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-green-900 via-gray-900 to-black flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-3xl font-bold text-green-500 mb-6 text-center">๐ ุฏูุฑ ุงูุทุจูุจ</h2>
          <p className="text-white text-center mb-6">ุงุฎุชุฑ ุงูุดุฎุต ุงูุฐู ุชุฑูุฏ ุญูุงูุชู</p>
          
          <div className="space-y-2 max-h-96 overflow-y-auto">
            {roles.map((player, index) => (
              <button
                key={index}
                onClick={() => handleDoctorSave(player.name)}
                className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl transition-all"
              >
                {player.name}
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  if (nightPhase === 'detective') {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-900 via-gray-900 to-black flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-3xl font-bold text-blue-500 mb-6 text-center">๐ ุฏูุฑ ุงููุญูู</h2>
          <p className="text-white text-center mb-6">ุงุฎุชุฑ ุงูุดุฎุต ุงูุฐู ุชุฑูุฏ ุงูุชุญูู ููู</p>
          
          <div className="space-y-2 max-h-96 overflow-y-auto">
            {roles.map((player, index) => (
              <button
                key={index}
                onClick={() => handleDetectiveInvestigate(player.name)}
                className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl transition-all"
              >
                {player.name}
              </button>
            ))}
          </div>
        </div>
      </div>
    );
  }

  if (nightPhase === 'results') {
    const playerSurvived = killedPlayer === savedPlayer;
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
        <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
          <h2 className="text-3xl font-bold text-white mb-8 text-center">โ๏ธ ูุชุงุฆุฌ ุงููููุฉ</h2>
          
          <div className="space-y-6">
            <div className="bg-red-900 p-6 rounded-xl">
              <h3 className="text-xl font-bold text-white mb-2">ุงููุงููุง ุงุฎุชุงุฑ:</h3>
              <p className="text-2xl text-red-300">{killedPlayer}</p>
            </div>

            <div className="bg-green-900 p-6 rounded-xl">
              <h3 className="text-xl font-bold text-white mb-2">ุงูุทุจูุจ ุญูู:</h3>
              <p className="text-2xl text-green-300">{savedPlayer}</p>
            </div>

            {playerSurvived ? (
              <div className="bg-green-600 p-6 rounded-xl text-center">
                <p className="text-2xl font-bold text-white">โจ ูุฌุง ุงููุงุนุจ ูู ุงูููุช!</p>
              </div>
            ) : (
              <div className="bg-red-600 p-6 rounded-xl text-center">
                <p className="text-2xl font-bold text-white">๐ {killedPlayer} ูุงุช!</p>
              </div>
            )}

            <div className="bg-blue-900 p-6 rounded-xl">
              <h3 className="text-xl font-bold text-white mb-2">ุงููุญูู ุณุฃู ุนู:</h3>
              <p className="text-2xl text-blue-300 mb-2">{investigatedPlayer}</p>
              <p className="text-xl text-white font-bold">{investigationResult}</p>
            </div>
          </div>

          <button
            onClick={() => {
              setScreen('home');
              setPlayers([]);
              setRoles([]);
              setNightPhase('');
            }}
            className="w-full mt-8 bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all"
          >
            ูุนุจุฉ ุฌุฏูุฏุฉ
          </button>
        </div>
      </div>
    );
  }

  return null;
}