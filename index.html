<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ูุนุจุฉ ูุงููุง</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    body { font-family: 'Cairo', sans-serif; }
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
  </style>
</head>
<body class="bg-gray-900 text-white">

<div id="app" class="min-h-screen flex items-center justify-center p-4"></div>

<script>
  // ุงุณุชุจุฏุงู ุฃููููุงุช Lucide
  lucide.createIcons();

  const { useState, useEffect } = React;
  const { Users, Play, Plus, X, Eye, EyeOff, Moon, SkipForward, AlertCircle } = lucide;

  function MafiaGame() {
    const [screen, setScreen] = useState('home');
    const [players, setPlayers] = useState([]);
    const [newPlayerName, setNewPlayerName] = useState('');
    const [mafiaCount, setMafiaCount] = useState(1);
    const [roles, setRoles] = useState([]);
    const [currentPlayerIndex, setCurrentPlayerIndex] = useState(0);
    const [showRole, setShowRole] = useState(false);
    const [nightPhase, setNightPhase] = useState('');
    const [killedPlayer, setKilledPlayer] = useState('');
    const [savedPlayer, setSavedPlayer] = useState('');
    const [investigatedPlayer, setInvestigatedPlayer] = useState('');
    const [investigationResult, setInvestigationResult] = useState('');
    const [nightIntro, setNightIntro] = useState(false);        // ุฌุฏูุฏ
    const [countdown, setCountdown] = useState(10);            // ุฌุฏูุฏ
    const [currentNight, setCurrentNight] = useState(1);       // ุฌุฏูุฏ

    // Countdown ููููุฉ ุงูุชูููุฏูุฉ
    useEffect(() => {
      if (nightIntro && countdown > 0) {
        const timer = setTimeout(() => setCountdown(c => c - 1), 1000);
        return () => clearTimeout(timer);
      } else if (nightIntro && countdown === 0) {
        startNightActions();
      }
    }, [nightIntro, countdown]);

    const addPlayer = () => {
      if (newPlayerName.trim() && players.length < 14) {
        setPlayers([...players, newPlayerName.trim()]);
        setNewPlayerName('');
      }
    };

    const removePlayer = i => setPlayers(players.filter((_, idx) => idx !== i));

    const startGame = () => {
      if (players.length < 4) return alert('ูุฌุจ ุฃู ูููู ููุงู ุนูู ุงูุฃูู 4 ูุงุนุจูู!');
      const gameRoles = ['ุทุจูุจ', 'ูุญูู'];
      for (let i = 0; i < mafiaCount; i++) gameRoles.push('ูุงููุง');
      while (gameRoles.length < players.length) gameRoles.push('ููุงุทู');

      const shuffled = gameRoles.sort(() => Math.random() - 0.5);
      const playerRoles = players.map((name, i) => ({ name, role: shuffled[i] }));
      setRoles(playerRoles);
      setCurrentPlayerIndex(0);
      setShowRole(false);
      setScreen('reveal');
    };

    const nextPlayer = () => {
      if (currentPlayerIndex < roles.length - 1) {
        setCurrentPlayerIndex(currentPlayerIndex + 1);
        setShowRole(false);
      } else {
        setScreen('instructions');
      }
    };

    // ุจุฏุก ุงูุชูููุฏ ููููุฉ
    const startNightIntro = () => {
      setNightIntro(true);
      setCountdown(10);
      setKilledPlayer('');
      setSavedPlayer('');
      setInvestigatedPlayer('');
      setInvestigationResult('');
    };

    // ุชุฎุทู ุงููููุฉ ูุจุงุดุฑุฉ
    const skipNight = () => {
      if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ุฃูู ุชุฑูุฏ ุชุฎุทู ุงููููุฉ ${currentNight}?`)) {
        setNightIntro(false);
        setNightPhase('results');
      }
    };

    // ุจุนุฏ ุงูุชูุงุก ุงูุนุฏ ุงูุชูุงุฒูู ุฃู ุงูุชุฎุทู
    const startNightActions = () => {
      setNightIntro(false);
      setNightPhase('mafia');
    };

    const handleMafiaKill = name => { setKilledPlayer(name); setNightPhase('doctor'); };
    const handleDoctorSave = name => { setSavedPlayer(name); setNightPhase('detective'); };
    const handleDetectiveInvestigate = name => {
      setInvestigatedPlayer(name);
      const p = roles.find(x => x.name === name);
      setInvestigationResult(p.role === 'ูุงููุง' ? 'ูุนูุ ูู ูุงููุง!' : 'ูุงุ ููุณ ูุงููุง');
      setNightPhase('results');
    };

    const nextNight = () => {
      setCurrentNight(n => n + 1);
      setNightPhase('');
      setNightIntro(true);
      setCountdown(10);
    };

    const getRoleColor = r => {
      if (r === 'ูุงููุง') return 'bg-red-600';
      if (r === 'ุทุจูุจ') return 'bg-green-600';
      if (r === 'ูุญูู') return 'bg-blue-600';
      return 'bg-gray-600';
    };

    // ุดุงุดุฉ ุงูุชูููุฏ ููููุฉ
    if (nightIntro) {
      return (
        <div className="min-h-screen bg-black flex items-center justify-center relative overflow-hidden">
          <div className="absolute inset-0 bg-gradient-to-br from-purple-900 via-black to-black opacity-90"></div>
          <div className="z-10 text-center">
            <h1 className="text-6xl font-bold text-purple-400 mb-8 animate-pulse">
              ุงููููุฉ {currentNight === 1 ? 'ุงูุฃููู' : currentNight === 2 ? 'ุงูุซุงููุฉ' : `${currentNight}`} ุชุจุฏุฃ...
            </h1>
            <div className="text-9xl font-bold text-red-600 mb-10">{countdown}</div>
            <button
              onClick={skipNight}
              className="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-4 px-8 rounded-xl flex items-center gap-3 mx-auto text-xl"
            >
              <lucide.SkipForward size={32} />
              ุชุฎุทู ุงููููุฉ
            </button>
          </div>
        </div>
      );
    }

    // ุจุงูู ุงูุดุงุดุงุช ููุง ูู ูุน ุชุนุฏููุงุช ุจุณูุทุฉ...
    if (screen === 'home') {
      // ... ููุณ ููุฏ ุงูู home ุงูุณุงุจู (ุงุฎุชุตุฑุชู ููุง ูุชูููุฑ ุงููุณุงุญุฉ ููู ุณุฃุถุนู ูุงูู ูู ุงูููุงูุฉ)
      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
          <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
            <div className="text-center mb-8">
              <h1 className="text-5xl font-bold text-white mb-2">๐ญ ูุงููุง</h1>
              <p className="text-gray-400">ูุนุจุฉ ุงูุบููุถ ูุงูุฎุฏุงุน</p>
            </div>
            <button onClick={() => setScreen('register')} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-xl mb-4 flex items-center justify-center gap-2 transition-all transform hover:scale-105">
              <lucide.Users size={24} /> ุชุณุฌูู ุงูุฃุณูุงุก
            </button>
            {players.length >= 4 && (
              <button onClick={startGame} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-2 transition-all transform hover:scale-105">
                <lucide.Play size={24} /> ุจุฏุก ุงููุนุจุฉ
              </button>
            )}
            {players.length > 0 && (
              <div className="mt-6 p-4 bg-gray-700 rounded-xl">
                <p className="text-white font-bold mb-2">ุงููุงุนุจูู: {players.length}</p>
                <div className="flex flex-wrap gap-2">
                  {players.map((p, i) => (
                    <span key={i} className="bg-purple-600 text-white px-3 py-1 rounded-full text-sm">{p}</span>
                  ))}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ุจุงูู ุงูุดุงุดุงุช (register, reveal, instructions, mafia, doctor, detective, results) ููุณูุง ุชูุงููุง
    // ููุท ูู ุดุงุดุฉ instructions ุบููุฑ ุงูุฒุฑ ุฅูู:
    if (screen === 'instructions') {
      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
          <div className="max-w-2xl w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
            <h2 className="text-4xl font-bold text-white mb-8 text-center">๐ ุชุฑุชูุจ ุงููููุฉ</h2>
            <div className="space-y-6 mb-8">
              <div className="bg-red-900 p-6 rounded-xl"><h3 className="text-2xl font-bold text-white mb-2">1๏ธโฃ ุฏูุฑ ุงููุงููุง</h3><p className="text-gray-300">ุงููุงููุง ูุฎุชุงุฑ ุดุฎุตูุง ูููุชู</p></div>
              <div className="bg-green-900 p-6 rounded-xl"><h3 className="text-2xl font-bold text-white mb-2">2๏ธโฃ ุฏูุฑ ุงูุทุจูุจ</h3><p className="text-gray-300">ุงูุทุจูุจ ูุฎุชุงุฑ ุดุฎุตูุง ููุญูุงูุฉ</p></div>
              <div className="bg-blue-900 p-6 rounded-xl"><h3 className="text-2xl font-bold text-white mb-2">3๏ธโฃ ุฏูุฑ ุงููุญูู</h3><p className="text-gray-300">ุงููุญูู ูุณุฃู ุนู ุดุฎุต: ูู ูู ูุงููุงุ</p></div>
            </div>
            <button onClick={startNightIntro} className="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105">
              ุงุจุฏุฃ ุงููููุฉ ุงูุฃููู
            </button>
          </div>
        </div>
      );
    }

    // ุดุงุดุฉ results ูุน ุฒุฑ "ุงููููุฉ ุงูุชุงููุฉ"
    if (nightPhase === 'results') {
      const survived = killedPlayer === savedPlayer;
      return (
        <div className="min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-gray-900 flex items-center justify-center p-4">
          <div className="max-w-md w-full bg-gray-800 rounded-2xl shadow-2xl p-8">
            <h2 className="text-3xl font-bold text-white mb-8 text-center">โ๏ธ ูุชุงุฆุฌ ุงููููุฉ {currentNight}</h2>
            <div className="space-y-6">
              <div className="bg-red-900 p-6 rounded-xl"><h3 className="text-xl font-bold text-white mb-2">ุงููุงููุง ุงุฎุชุงุฑ:</h3><p className="text-2xl text-red-300">{killedPlayer || 'ูู ูููุชู ุฃุญุฏ'}</p></div>
              <div className="bg-green-900 p-6 rounded-xl"><h3 className="text-xl font-bold text-white mb-2">ุงูุทุจูุจ ุญูู:</h3><p className="text-2xl text-green-300">{savedPlayer || 'ูู ูุญูู ุฃุญุฏ'}</p></div>
              {survived ? 
                <div className="bg-green-600 p-6 rounded-xl text-center"><p className="text-3xl font-bold">ูุฌุง ุงููุงุนุจ!</p></div> :
                killedPlayer && <div className="bg-red-600 p-6 rounded-xl text-center"><p className="text-3xl font-bold">๐ {killedPlayer} ูุงุช!</p></div>
              }
              <div className="bg-blue-900 p-6 rounded-xl"><h3 className="text-xl font-bold text-white mb-2">ุงููุญูู ุณุฃู ุนู {investigatedPlayer}</h3><p className="text-xl font-bold">{investigationResult}</p></div>
            </div>
            <div className="flex gap-4 mt-8">
              <button onClick={nextNight} className="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-4 rounded-xl">
                ุงููููุฉ ุงูุชุงููุฉ
              </button>
              <button onClick={() => location.reload()} className="flex-1 bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 rounded-xl">
                ูุนุจุฉ ุฌุฏูุฏุฉ
              </button>
            </div>
          </div>
        </div>
      );
    }

    // ุฃุถู ุจุงูู ุงูุดุงุดุงุช (reveal, mafia, doctor, detective) ููุง ูู ุชูุงููุง ูู ููุฏู ุงูุฃุตูู
    // ูู ุฃุนูุฏ ูุชุงุจุชูุง ูููุง ููุง ููุงุฎุชุตุงุฑุ ููููุง ููุฌูุฏุฉ ูู ุงูููุฏ ุงููุงูู ุฃุฏูุงู

    return null;
  }

  // === ุจุงูู ุงูููุฏ ูุงูู (ุณุฃุนุทูู ุงููุณุฎุฉ ุงููุงููุฉ ุงูุฌุงูุฒุฉ ูู ุงูุฑุณุงูุฉ ุงูุชุงููุฉ ูุฃููุง ุทูููุฉ ุฌุฏูุง) ===

  const root = ReactDOM.createRoot(document.getElementById('app'));
  root.render(<MafiaGame />);
</script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</body>
</html>
